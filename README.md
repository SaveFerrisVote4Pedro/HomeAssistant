# HomeAssistant
YAML and Node-RED code for Home Assistant automations and scripts

## About

From starting with a Raspberry Pi 2, I have moved to using HA on an old notebook PC running Proxmox

I have mainly been using Node-RED to create automations in Home Assistant, using a combination of wiring nodes together, as well as using JavaScript in functions.

I've been working on these for quite a few years

## Weather

* Morning weather forecast, UV forecast (only if it is above 5), current rain, car driving range and drive time to work. Announcement is triggered when someone enters the kitchen in the morning after 7am (or after 9am on weekends and school holidays)
* [Notifies me if the car's windscreens might have ice on them] (/SaveFerrisVote4Pedro/HomeAssistant/Weather/Frost notification) (based on a trigger formula using time of day, humidity, temperature and wind speed overnight and in the morning)
* Announcements of rain, lightning or very high wind gusts. Rain turns lamp blue and a snippet of "It's raining men" plays. For lighting, the lamp strobes yellow and "Thunderbolts and lightning, very very frightening" plays from Bohemian Rhapsody.

## Mail and packages

* Announcement of mail at our letterbox (and snapshot of video vision of letterbox). Also announcement of package deliveries at the local post office. Smart speaker plays the AOL "You've got mail" sound

## Bathroom

* Announcements and notifications if the bathroom shower isn't draining properly. Google display in bathroom plays a video that tells the person showering to turn off the taps
* Bathroom fan automatically switches on based on a detected rise in humidity (the shower is on) and the fan remains on until humidity levels return to their original baseline level. This uses the trend feature to account for natural changes in humidity during the day (is it a humid day or a dry day already?)
* Bathroom lights turn on using a combination of IR motion detection and radar mmWave (meaning lights stay on if there's no IR triggered motion). After midnight, lights come on at a lower brightness level
* Bathroom floor heating will only activate if the weather forecast is for a cold day. This updates throughout the day (and doesn't rely upon a Nest style smart thermometer)
* Switches off heated towel rail after 6 hours of being on

## Car

* If both charging bays at my work are occupied, using a Google Maps / Google Cloud API sensor, Home Assistant checks every 15 minutes for when one of the bays is available. This pops up a notification on my PC, on my watch and an audible announcement on my phone (via the Home Assistant app)
* On work mornings, or by asking Google, pressing a ZigBee button or a widget on my phone, I can get my car’s AC to run, but only if it's needed.
* On work mornings, or by asking Google, pressing a ZigBee button or a widget on my phone, I can trigger my car's doors to unlock (as well as the pop frunk on work days) when I open the front door of the house. This won't trigger automatically if it isn't a work day, is after 9am and also if there's been motion in our front yard (you don't want the car to unlock if someone comes to the front door)
* Notifications if car tyres need more air

## Notification quiet time

* Smart speaker notifications and phone notifications generated by Home Assistant don't trigger overnight so to not wake people sleeping. I can also set a one hour pause (including by voice)

## Away

* House detects when we're away and asks if I want to set the house to "away mode"
* House detects when we're arriving home and will ask if we want the heating or cooling activated

## Lighting

* Lamps in the house automatically go on if the outside brightness drops below a certain threshold. Lights will automatically switch off if it becomes brighter outside

## Music

* If music is selected to play through a Google Chromecast Audio, a smart switch will automatically power up an amplifier hooked up to speakers (25 year old amplifier and speakers). If music has been shut off for 20 seconds, power to the amplifier is switched off
* If a certain singer's song starts playing on Spotify (which members in our family detest), Home Assistant will automatically skip the song
* If my Pixel phone's automatic song detection detects the same artist playing on the radio (via TuneIn on the Chromecast Audio and amplifier), the amplifier’s volume drops for a few minutes and some alternate "elevator music" plays instead. The radio's volume resumes to a normal after that and the streamed audio continues playing.

## Shutdown / reboot

* If I ask the Google Speaker to "Shut it down" the TV mutes, switches back to it's default TV channel, then the TV, lamp, amplifier and AC switch off
* Can safely issue a command to shut down a server, wait for it to power off (detected via no ping response), power off, wait a minute, then power back on. Used to do a weekly reboot on a server. Will notify me if there are any issues with it not shutting down or rebooting successfully
* Will issue a shut down then power off of a server if enclosure temperature or internal temperature (CPU and HD) reach certain thresholds

## Mornings

* If it's a cold morning and the forecast is for a cold day, the air conditioning preheats the kitchen area to give it a temperature boost

## Air quality

* If outside air quality changes (we've had bad smoke from nearby bushfires in previous summers) the Google speakers announce if the air quality is poor.
* Carbon monoxide sensor (ZigBee battery powered) plays loud alarms on all speakers, TVs and flashes all smart lights of CO goes to dangerous levels

## Bin night

* House announces at 8pm that it is bin night and which bins are due to go out (recycling, organics or landfill). If we're not home, it delays this announcement until 10 minutes after we've arrived home (to give us time to finish unpacking the car etc). Display on Home Assistant dashboard visually shows which bins need to go out too.

## Battery levels

* All ZigBee battery powered devices notify me of they are not functioning or if batteries are low

## Sport

* If Australia wins a medal in the Olympics, we get a patriotic announcement. The medal type we've won is announced and a medal tally is kept on the Home Assistant dashboard

## TV

* Air conditioning and TV are controlled via an IR blaster.
* TV volume can be faded up or down 10% with a single tap of a button on a TV IR remote dashboard. Set to be sequential so 2 taps will adjust by 20% and so on

## Laundry

* Using a power monitoring switch, can detect what stage the of their cycles the washing machine and dryer are on, based on their electricity usage

## Air conditioning

* Detects if air conditioner has been turned on or off with its IR remote and detects (using temperature trending) if it set to heat or cool

## Networked devices

* Can reboot printer and modem (via power disconnection) if they become unresponsive
* Dashboard for firmware updates for various devices - Zigbee, servers, Wifi etc
* Weekly configuration backup triggers, TTS cache clearing, SSL certificate updates etc

## Cameras

* Saves a timelapse of cameras if required

## PVR

* Lists 10 most recent recordings and upcoming scheduled recordings from open source PVR
* Notifies me if Kodi media player stops functioning

## Public transport

* Uses PTV public transport API to announce real time arrivals of nearby bus services. Could be expanded to detect trends (ie., if buses are running late due to traffic issues)

## Power

* Forecasts current solar power potential generation (based on current solar radiation, efficiency of solar panels and number of installed panels)
* Calculated annual EV tax based on odometer readings and mileage trigger thresholds

## Dashboard

* Changes Home Assistant dashboard to dark mode at time, back to normal in the morning

## Device control

* Most triggers can be disabled via switch settings in the Home Assistant dashboard
* Notifies me if a number of ZigBee sensors are offline (indicating problem with ZigBee bridge)
* Notifies me if a number of Wifi devices are offline (indicating problem with WIfi)
* Notifications of household power loss
* Notifications of UPS issues
* Use Ikea 5 button remote to control fan, lamps, media player controls and volume in a bedroom
* Use Zigbee buttons to control the brightness of lamps. One through 4 clicks increment lamp brightness by 25%, holding down on Zigbee button switches off one lamp, an extended holding of the button switches off groups of lamps

That's pretty much all I can think of at this point
